<div id="outline-container-org9cdae71" class="outline-2">
<h2 id="org9cdae71"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This is to provide a detailed checklist on what makes for a good command line
program.
</p>

<p>
The quick list:
</p>

<ol class="org-ol">
<li>Provide usage information.</li>
<li>Output parse-able output to <code>stdout</code>.</li>
<li>Output logging to <code>stderr</code>.</li>
<li>Have a <code>--help</code> that describes basic usage and general purpose.</li>
<li>Use exit code 0 for expected results, and positive, non-zero exit codes for
unexpected results.</li>
</ol>
</div>
</div>
<div id="outline-container-orgfdb67f5" class="outline-2">
<h2 id="orgfdb67f5"><span class="section-number-2">2.</span> Disclaimer</h2>
<div class="outline-text-2" id="text-2">
<p>
You can always view my <a href="./resume.html">résumé</a> here on the blog.  From that you can infer a lot
about my experience and things I&rsquo;ve done.  I don&rsquo;t wish to appeal to authority,
but having some experience in the field should amount to something.  I deal with
this stuff on a day to day basis, and from that I&rsquo;ve learned some things.  You
can decide for yourself if it&rsquo;s poorly acquired trauma or wisdom that comes with
age.
</p>

<p>
I tend to examine &ldquo;standards&rdquo; with high levels of scrutiny, as they can be put
together by almost anyone with vast quantities of spare time and an unhealthy
addiction to work.  I hope my work here is placed under similar scrutiny.  Bad
ideas should perish and good ideas should thrive.  Of course, the real world
contains a lot of nuance.  I find it best to know what the ideal course is, and
then deviate as needs dictate.
</p>

<p>
You will not gain my support by quoting my words as truth.  But use this to be
inspired to pitch your own arguments and form your own ideas.
</p>

<p>
In short: I know some things.  I think to think for myself.  So should you,
including scrutinizing anything I emit.
</p>
</div>
</div>
<div id="outline-container-org032ef19" class="outline-2">
<h2 id="org032ef19"><span class="section-number-2">3.</span> Help and Usage</h2>
<div class="outline-text-2" id="text-3">
<p>
The <a href="https://agilemanifesto.org">Agile Manifesto</a> tells us to favor &ldquo;working software over comprehensive
documentation&rdquo;, but I find this akin to waiting until someone falls in a hole
and dies before you decide to put up a sign that there&rsquo;s a hole where one could
fall in and die.
</p>

<p>
Providing a help/usage information for your program is a must-have. Even
simplistic programs should provide a brief description of what they do and any
arguments they expect. The <span class="underline">program</span> must provide this information, not your
code (though that has incredible merit as well).
</p>

<p>
When a program isn&rsquo;t provided the information it needs, the <b>minimal</b> operation
is to display the usage information and quit with a non-zero exit code.
</p>

<p>
The usage information itself describes the arguments available, order (if
applicable), required arguments vs. optional, and if the argument can be
repeated (such as file names).
</p>

<p>
IEEE has a <a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html">Utility Conventions</a> document that covers a standard formatting
convention to use. Most programs I&rsquo;ve seen use this convention, and there&rsquo;s not
really a great reason to abandon it. Many command line argument libraries
provide this usage information automatically, but the onus is always on the
program maintainer to provide documentation as to the purpose of the arguments
themselves.
</p>

<p>
Some programs can be very complicated and so require lots of explanations,
examples, warnings, etc. This is where a <a href="https://liw.fi/manpages/">manual page</a> (or &ldquo;man page&rdquo;) comes in
handy. I wouldn&rsquo;t worry too much about the ancient <code>troff</code> format. <a href="https://pandoc.org/">Pandoc</a>
supports <a href="https://www.gnu.org/software/groff/groff.html">groff</a> (GNU&rsquo;s <code>troff</code>) and therefore can convert Markdown and Org-mode
documents to man pages. Though I would check to make sure the output is rendered
in a canonical fashion: There might be things in <code>troff</code> that a format like
Markdown doesn&rsquo;t represent well like glossary definitions, for example.
</p>

<p>
Your bare minimum can include the script name (which can typically be determined
automatically), and any arguments you need.
</p>

<p>
Here&rsquo;s an example of a bash script with zero arguments. You can use <code>$0</code> to
refer to the script itself, and subsequent numbers refer to the ordered
arguments. So <code>$1</code> is the first argument after the script name.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #62686E;">#</span><span style="color: #62686E;">!/usr/bin/</span><span style="color: #51afef;">env</span><span style="color: #62686E;"> bash</span>

<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span><span style="color: #C57BDB;">[</span> $<span style="color: #e69055; font-weight: bold;">1</span> == <span style="color: #7bc275;">'--help'</span> || $<span style="color: #e69055; font-weight: bold;">1</span> == <span style="color: #7bc275;">'-h'</span> <span style="color: #C57BDB;">]</span><span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
  <span style="color: #FCCE7B;">echo</span> <span style="color: #7bc275;">"usage: </span><span style="color: #a991f1;">$</span><span style="color: #dcafe9;">0</span>

<span style="color: #7bc275;">Frobnicates anything needing frobnication.</span>
<span style="color: #7bc275;">"</span>
  <span style="color: #51afef;">exit</span> <span style="color: #e69055; font-weight: bold;">0</span>
<span style="color: #51afef;">fi</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">The rest of the script goes below.</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbf669ed" class="outline-2">
<h2 id="orgbf669ed"><span class="section-number-2">4.</span> Logging and Output</h2>
<div class="outline-text-2" id="text-4">
<p>
Typically a lot of command line programs are rather silent - they don&rsquo;t output
much. It&rsquo;s totally fine though to sprinkle logging throughout your program - in
fact, for all but the most trivial programs I encourage this! But be sure to
provide a distinction between <b>logging</b> and <b>output</b>.
</p>

<p>
The <a href="https://en.wikipedia.org/wiki/Unix_philosophy">Unix philosopy</a> has a lot of useful tidbits in it, but of particular note is
this item:
</p>

<blockquote>
<p>
Expect the output of every program to become the input to another, as yet
unknown, program. Don&rsquo;t clutter output with extraneous information. Avoid
stringently columnar or binary input formats. Don&rsquo;t insist on interactive input.
</p>
</blockquote>

<p>
This flows into very practical advice for logging and your program output.
</p>
</div>
<div id="outline-container-org18b3815" class="outline-3">
<h3 id="org18b3815"><span class="section-number-3">4.1.</span> Logging and Log Levels</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Logging is the program printing out diagnostic or progress information to the
user. &ldquo;Found file X&rdquo;, &ldquo;Calling server with $URL&rdquo;, and &ldquo;Server rejected our call
with message&#x2026;&rdquo; are all great things to have in your logs. Logs should always
go to <code>stderr</code> (standard error). Different languages tend to use different names
for this. Ruby&rsquo;s writing to <code>stderr</code> is called <code>warn</code> and Node.JS uses
<code>console.error</code>. That said, it&rsquo;s recommended to use a logger with log levels.
This way you can distinguish apart messages for errors, general information,
warnings, debugging statements, and so on. Most loggers can be configured to
point at a particular destination. One of those can be whatever your languages
uses for <code>stderr</code>, which is covered in your language&rsquo;s documentation. Logging
always goes to <code>stderr</code> so that other programs (usually shells) can use program
output without having to be aware of any kind of logging. We&rsquo;ll cover this more
in <a href="#orga68ffe1">4.2</a>.
</p>

<p>
Additionally for logging, this sort of information can be provided via
arguments. I&rsquo;ve seen <code>--debug</code>, <code>--verbose</code>, <code>--info</code> and other flags like this.
I don&rsquo;t prefer them because they are both subjective. I&rsquo;ve seen a suite of
programs inconsistently use <code>--debug</code> and <code>--verbose</code> for the same thing, for
example. Additionally, if both <code>--debug</code> and <code>--info</code> arrive as a result of some
automation gone wonky, what happens there? Does it log <code>--debug</code>? <code>--info</code>? Does
your documentation state which one wins? Or do you put in login into the
argument handling to make sure these are exclusive arguments? I really like how
<code>ssh</code> handles it: There is a single short-hand <code>-v</code> argument for verbosity. You
can dial up the verbosity with additional &ldquo;v&rdquo;s. So <code>-vvv</code> is the 3rd level of
verbosity.
</p>
</div>
</div>
<div id="outline-container-orga68ffe1" class="outline-3">
<h3 id="orga68ffe1"><span class="section-number-3">4.2.</span> Output</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Output should always be printed to <code>stdout</code> (apart from logging, which goes to
<code>stderr</code>). This allows other programs (such as shells) to easily work with
output. For example, <code>curl</code> uses this pattern to much obviousness:
</p>

<div class="org-src-container">
<pre class="src src-shell"> <span style="color: #FCCE7B;">echo</span> <span style="color: #7bc275;">'* foo'</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-shell"> <span style="color: #FCCE7B;">curl</span> -k --verbose --silent https://google.com &gt; /dev/null
</pre>
</div>

<p>
Here, you can see all of the verbose information that curl prints - headers in
both the request and response, as well as the SSL handshake. We could redirect
that to a saved file.
</p>
</div>
</div>
</div>
<div id="outline-container-org3ea6e3a" class="outline-2">
<h2 id="org3ea6e3a"><span class="section-number-2">5.</span> Exit Codes</h2>
<div class="outline-text-2" id="text-5">
<p>
Exit codes are unsigned 8 bit numbers (0-255). 0 is interpreted as success.
Everything else is a failure. These are used to not only detect failures in a
series of programs, but also determine what kind of failure.
</p>

<div class="org-src-container">
<pre class="src src-shell">nosuchcommand <span style="color: #62686E;"># </span><span style="color: #62686E;">Run a fake command to create a failure.</span>
</pre>
</div>

<p>
By default, shells will keep running commands regardless of failure. This can
have poor consequences.
</p>

<div class="org-src-container">
<pre class="src src-shell">create-report-now-please my-report.rpt <span style="color: #62686E;"># </span><span style="color: #62686E;">Fake command. Will fail.</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">my-report.rpt was never created by the time we get here. Since there are no</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">reports, this publish-all-reports command could omit any errors since there</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">are no reports found to publish, or perhaps it found some reports, but just</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">not "my-report.rpt".</span>
publish-all-reports
</pre>
</div>
</div>
<div id="outline-container-org78f6a4a" class="outline-3">
<h3 id="org78f6a4a"><span class="section-number-3">5.1.</span> Standard Exit Codes<span class="tag"><span class="archive">archive</span></span></h3>
<div class="outline-text-3" id="text-5-1">
<p>
I need to vet this before publishing it.
</p>

<p>
There are some standards for exit codes as well.  The advanced Bash guide covers
<a href="https://tldp.org/LDP/abs/html/exitcodes.html">exit codes of reserved meaning in Bash</a>.  This is not quite the same as a
standard for which all outcomes could be cataloged.  Instead this gives us some
predictable outcome.
</p>

<p>
While I have found many to find this kind of thing archaic.  It&rsquo;s not terribly
different from how the vaunted HTTP standard works.  <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">HTTP codes</a> rain <a href="https://http.cat">cats</a> and
<a href="https://http.dog">dogs</a> from the standard.
</p>
</div>
</div>
</div>
