---
layout: default
title: Killer Queen Streaming Guide
date: 2017-11-05
categories: killer-queen
---

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org05c77f9">1. introduction</a></li>
<li><a href="#orgbc308d8">2. challonge integration</a>
<ul>
<li><a href="#org2b2a057">2.1. workarounds</a></li>
</ul>
</li>
<li><a href="#org9eee1a3">3. video flow</a></li>
<li><a href="#org6ed48de">4. audio flow</a></li>
<li><a href="#orgc5c71cd">5. pdx setup</a>
<ul>
<li><a href="#org22bca87">5.1. facilities</a></li>
<li><a href="#orga993aa1">5.2. hardware</a>
<ul>
<li><a href="#orgdf3f5d6">5.2.1. video</a></li>
<li><a href="#org7ac2229">5.2.2. audio</a></li>
<li><a href="#orgf7842b5">5.2.3. all together now</a></li>
<li><a href="#orga644610">5.2.4. anti trip trick</a></li>
</ul>
</li>
<li><a href="#org512ab74">5.3. software</a>
<ul>
<li><a href="#org78e3a1c">5.3.1. challonge</a></li>
<li><a href="#org0d24e58">5.3.2. kq-tournament</a></li>
<li><a href="#org27a2abe">5.3.3. OBS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0ffd586">6. troubleshooting</a>
<ul>
<li><a href="#orgc1aef34">6.1. If the input is not recognized on the computer's end</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org05c77f9" class="outline-2">
<h2 id="org05c77f9"><span class="section-number-2">1</span> introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
As part of trying to reduce the Portland scene's <a href="https://en.wikipedia.org/wiki/Bus_factor">bus number</a> in regards to our
streaming setup I've recorded notes here as best I can. The dream is to have a
pretty foolproof setup that anyone mildly technically competent could apply to
their scene's cab. People can and should provide suggestions and corrections so
our community can better thrive. As a general policy I won't use a comment
system on this site because static hosting is awesome and also because
<a href="https://github.com/tessalt/echo-chamber-js">echo-chamber.js</a> makes an excellent point. Feel free to contact me via email,
Twitter, or carrier pigeon for any improvements we can make here.
</p>
</div>
</div>

<div id="outline-container-orgbc308d8" class="outline-2">
<h2 id="orgbc308d8"><span class="section-number-2">2</span> challonge integration</h2>
<div class="outline-text-2" id="text-2">
<p>
Need access to Matt Wire's github repo that has a Rails server.
</p>
<ul class="org-ul">
<li><a href="https://github.com/boxofmattwire/kq-tournament">Matt Wire's repo</a></li>
<li><a href="https://github.com/LoganBarnett/kq-tournament">Logan's fork</a></li>
</ul>

<p>
Currently this repo isn't public.
</p>
</div>

<div id="outline-container-org2b2a057" class="outline-3">
<h3 id="org2b2a057"><span class="section-number-3">2.1</span> workarounds</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Changes to the Challonge setup screws up the integration with the Rails server.
The Rails server at that point can't be used (or maybe the data would need to be
wiped). At that point, the server is basically useless to us (and we shouldn't
try troubleshooting the server during a streaming run if possible). Instead
there are text files which override the blue score, blue name, gold score, and
gold name. These appear to be sources in OBS. I haven't verified this yet.
</p>
</div>
</div>
</div>

<div id="outline-container-org9eee1a3" class="outline-2">
<h2 id="org9eee1a3"><span class="section-number-2">3</span> video flow</h2>
<div class="outline-text-2" id="text-3">
<p>
There is a 4 port splitter in cab. Two go to the two monitors. The overhead
monitor takes another slot, and the projector takes the final.
</p>

<p>
This is how our specific setup looks at PDX. Our stream box is the computer
running <a href="http://openbroadcaster.com">OBS</a>.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="video-flow.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org6ed48de" class="outline-2">
<h2 id="org6ed48de"><span class="section-number-2">4</span> audio flow</h2>
<div class="outline-text-2" id="text-4">
<p>
Audio runs a weird loop. The mics wire into a mixer that runs to <span class="underline">another</span>
mixer. It's necessary for the headphones to get both the output of the computer
and the <a href="https://en.wikipedia.org/wiki/Sidetone">sidetone</a> of the mics themselves. Sidetone is useful so speakers get a
sense that the system is picking up their voice, and also gives them a sense of
how loud they are being picked up.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="audio-loop.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
This setup also provides lots of knobs to turn in terms of making sure the
announcers can turn up their own voices and also turn up the input of what they
are hearing from the game. This is done individually per the mixer and amp knobs
available per input/output (mixer and amp, respectively). <span class="underline">Turn the computer's
audio up to 100% and announcers can turn down as needed.</span>
</p>
</div>
</div>

<div id="outline-container-orgc5c71cd" class="outline-2">
<h2 id="orgc5c71cd"><span class="section-number-2">5</span> pdx setup</h2>
<div class="outline-text-2" id="text-5">
<p>
This portion is specifically for the Portland setup at Ground Kontrol.
</p>
</div>
<div id="outline-container-org22bca87" class="outline-3">
<h3 id="org22bca87"><span class="section-number-3">5.1</span> facilities</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Generally we need:
</p>
<ul class="org-ul">
<li>A folding table</li>
<li>A rug to cover the cables that run between the cabs and the table</li>
<li>A power strip for all of the hardware</li>
<li>A laptop with Thunderbolt support (moderately recent Macs have one or two).</li>
</ul>

<p>
Thunderbolt ports are physically compatible with Mini Display. Thunderbolt ports
can accept a Mini Display port, but it doesn't go the other way around.
</p>

<p>
A nice to have is the Thunderbolt display. It's a monitor that connections via -
wait for it - Thunderbolt. The display has a webcam, and is a rather large
screen that the commentators can easily share. It also leaves the computer free
for doing score management, enqueuing commercials or transitions, and managing
other parts of the production. Right now the Thunderbolt Display is on loan from
Day Logan.
</p>
</div>
</div>

<div id="outline-container-orga993aa1" class="outline-3">
<h3 id="orga993aa1"><span class="section-number-3">5.2</span> hardware</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-orgdf3f5d6" class="outline-4">
<h4 id="orgdf3f5d6"><span class="section-number-4">5.2.1</span> video</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
HDMI is provided as an input source via a computer's Thunderbolt port (I need to
check, but I'm pretty sure it's not mini display port). This runs from the video
splitter to the laptop.
</p>


<div class="figure">
<p><img src="./assets/hdmi-to-thunderbolt-input-01.jpg" alt="hdmi-to-thunderbolt-input-01.jpg" />
</p>
</div>

<p>
When the device is working, you'll see a white light near the Thunderbolt
connection.
</p>


<div class="figure">
<p><img src="assets/hdmi-to-thunderbolt-input-activated-01.jpg" alt="hdmi-to-thunderbolt-input-activated-01.jpg" />
</p>
</div>
</div>
</div>

<div id="outline-container-org7ac2229" class="outline-4">
<h4 id="org7ac2229"><span class="section-number-4">5.2.2</span> audio</h4>
<div class="outline-text-4" id="text-5-2-2">
<p>
Here's the amp as labeled in the diagram above:
</p>


<div class="figure">
<p><img src="./assets/audio-4-channel-amp-01.jpg" alt="audio-4-channel-amp-01.jpg" />
</p>
</div>

<p>
We could use an image that's in focus&#x2026;
</p>

<p>
The 4 channel mixer:
</p>


<div class="figure">
<p><img src="./assets/audio-4-channel-mixer-01.jpg" alt="audio-4-channel-mixer-01.jpg" />
</p>
</div>

<p>
These devices appear to be very similar, but they are very different. Basically
the mixer combines a series of inputs into a single output, and the amp splits a
single input into a series of outputs.
</p>

<p>
The mic mixer:
</p>


<div class="figure">
<p><img src="./assets/audio-mic-mixer-01.jpg" alt="audio-mic-mixer-01.jpg" />
</p>
</div>

<p>
The mics connect directly to this.
</p>
</div>
</div>

<div id="outline-container-orgf7842b5" class="outline-4">
<h4 id="orgf7842b5"><span class="section-number-4">5.2.3</span> all together now</h4>
<div class="outline-text-4" id="text-5-2-3">

<div class="figure">
<p><img src="./assets/pdx-working-setup-01.jpg" alt="pdx-working-setup-01.jpg" />
</p>
</div>


<div class="figure">
<p><img src="./assets/pdx-working-setup-02.jpg" alt="pdx-working-setup-02.jpg" />
</p>
</div>
</div>
</div>

<div id="outline-container-orga644610" class="outline-4">
<h4 id="orga644610"><span class="section-number-4">5.2.4</span> anti trip trick</h4>
<div class="outline-text-4" id="text-5-2-4">
<p>
Ground Kontrol has seats that have these glowing strips on their corners and
sides.
</p>


<div class="figure">
<p><img src="./assets/anti-cable-snag-trick-01.jpg" alt="anti-cable-snag-trick-01.jpg" />
</p>
</div>

<p>
These strips slide up a little bit. There's a small channel between the strip
and the side of the seats. You can stuff some of the cables you need to run
(such as the cables for the webcams) into this channel. Here we've stuffed the
cables in there as best we can with the strip still up.
</p>


<div class="figure">
<p><img src="./assets/anti-cable-snag-trick-03.jpg" alt="anti-cable-snag-trick-03.jpg" />
</p>
</div>

<p>
Once the cables are in place, we can slide the strip back down, and it will hold
the cables in place well enough to prevent feet from kicking the cables out or
other snares from occurring. Here's the closed version with cables inserted:
</p>


<div class="figure">
<p><img src="./assets/anti-cable-snag-trick-04.jpg" alt="anti-cable-snag-trick-04.jpg" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org512ab74" class="outline-3">
<h3 id="org512ab74"><span class="section-number-3">5.3</span> software</h3>
<div class="outline-text-3" id="text-5-3">
<p>
[[]]
</p>
</div>

<div id="outline-container-org78e3a1c" class="outline-4">
<h4 id="org78e3a1c"><span class="section-number-4">5.3.1</span> challonge</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
The URL we use is in the format <code>kqpdx&lt;MMDDYY&gt;</code>, where <code>MM</code> is the number of the
month, <code>DD</code> the day of the month, and <code>YY</code> is the last two digits of the year.
If today's date is <span class="timestamp-wrapper"><span class="timestamp">&lt;2017-11-30 Thu&gt;</span></span>, the URL will be <code>kqpdx113017</code>.
</p>


<div class="figure">
<p><img src="./assets/challonge-name-01.png" alt="challonge-name-01.png" />
</p>
</div>

<p>
Here's a list of things to clicky or type:
</p>

<ul class="org-ul">
<li>Game: killer queen</li>
<li>Single Stage Tournament</li>
<li>Double Elimination</li>
<li>1-2 Matches</li>
<li>Provide a list of participants</li>
<li>Save and Continue</li>
</ul>

<p>
Example:
</p>


<div class="figure">
<p><img src="./assets/challonge-setup-01.png" alt="challonge-setup-01.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org0d24e58" class="outline-4">
<h4 id="org0d24e58"><span class="section-number-4">5.3.2</span> kq-tournament</h4>
<div class="outline-text-4" id="text-5-3-2">
</div>
<ol class="org-ol">
<li><a id="org1c0a013"></a>installation<br />
<div class="outline-text-5" id="text-5-3-2-1">
<p>
Much of this is covered in the repo's <code>README.md</code>. This assumes running on MacOS
or Linux. Windows is probably doable, but that's beyond the scope of this
document short of someone else's contribution.
</p>

<p>
All of the instructions below assume you're running out of a terminal. On MacOS,
you can run <code>Terminal.app</code> for this.
</p>

<p>
Your environment needs the following:
</p>
<ul class="org-ul">
<li><code>rbenv</code> or <code>rvm</code> so you can get on Ruby 2.2.3.</li>
<li>Postgres 9.4.5.0 (greater will probably work, but the <code>9</code> is likely important.</li>
<li>The <code>bundler</code> gem installed globally.</li>
<li><code>git</code></li>
<li>A <a href="https://github.com">Github</a> account for cloning the repository.</li>
<li>Your public ssh key uploaded to github so you can clone the repository.</li>
</ul>

<p>
TODO: Open source the repository. Matt Wire has generously agreed to do this,
but it needs a little cleanup.
</p>

<p>
Clone the repository with git, and then <code>cd</code> into it.
</p>
<pre class="example">
git clone git@github.com:boxofmattwire/kq-tournament.git
cd kq-tournament
</pre>

<p>
Here's an example <code>database.yml</code>. This should go in <code>config/database.yml</code>. Note
that <code>username</code> and <code>password</code> is left out. You can add these in if you have
accounts setup on your PostgreSQL server. The stock setup from Homebrew allows
local connections with no credentials.
</p>

<div class="org-src-container">
<pre class="src src-yaml" id="orgec0abef"><span style="color: #7590db;">development</span>:
  <span style="color: #7590db;">adapter</span>: postgresql
  <span style="color: #7590db;">database</span>: kqt_dev
  <span style="color: #7590db;">pool</span>: 5
  <span style="color: #7590db;">timeout</span>: 5000
  <span style="color: #7590db;">encoding</span>: utf8

<span style="color: #7590db;">test</span>:
  <span style="color: #7590db;">adapter</span>: postgresql
  <span style="color: #7590db;">database</span>: kqt_test
  <span style="color: #7590db;">pool</span>: 5
  <span style="color: #7590db;">timeout</span>: 5000
  <span style="color: #7590db;">encoding</span>: utf8
</pre>
</div>

<p>
This creates the file for you:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #4f97d7;">echo</span> <span style="color: #2d9574;">"</span>
<span style="color: #2d9574;">development:</span>
<span style="color: #2d9574;">  adapter: postgresql</span>
<span style="color: #2d9574;">  database: kqt_dev</span>
<span style="color: #2d9574;">  pool: 5</span>
<span style="color: #2d9574;">  timeout: 5000</span>
<span style="color: #2d9574;">  encoding: utf8</span>

<span style="color: #2d9574;">test:</span>
<span style="color: #2d9574;">  adapter: postgresql</span>
<span style="color: #2d9574;">  database: kqt_test</span>
<span style="color: #2d9574;">  pool: 5</span>
<span style="color: #2d9574;">  timeout: 5000</span>
<span style="color: #2d9574;">  encoding: utf8</span>
<span style="color: #2d9574;">"</span> &gt; config/database.yml
</pre>
</div>

<p>
Install all of the gems the repo uses.
</p>

<div class="org-src-container">
<pre class="src src-sh">bundle install
</pre>
</div>

<p>
Assuming a Homebrew installed postgres, the database server is started like so:
</p>
<div class="org-src-container">
<pre class="src src-sh">pg_ctl -D /usr/local/var/postgres start
</pre>
</div>

<p>
It can be shut down with:
</p>
<pre class="example">
pg_ctl -D /usr/local/var/postgres stop
</pre>

<p>
Create the initial database and its tables.
</p>
<div class="org-src-container">
<pre class="src src-sh">bundle exec rake db:create db:migrate
</pre>
</div>
</div>
</li>

<li><a id="org6d44c50"></a>running<br />
<div class="outline-text-5" id="text-5-3-2-2">
<p>
Once you have everything setup and the database server is running:
</p>
<div class="org-src-container">
<pre class="src src-sh">bundle exec rails server
</pre>
</div>
</div>
</li>

<li><a id="orge367cf8"></a>stopping<br />
<div class="outline-text-5" id="text-5-3-2-3">
<p>
Hold <code>Ctrl</code> and press <code>C</code>. This will return you to your normal shell prompt.
</p>

<p>
Then shut down the database server:
</p>
<pre class="example">
pg_ctl -D /usr/local/var/postgres stop
</pre>
</div>
</li>

<li><a id="orgab18708"></a>operating<br /></li>
</ol>
</div>

<div id="outline-container-org27a2abe" class="outline-4">
<h4 id="org27a2abe"><span class="section-number-4">5.3.3</span> OBS</h4>
<div class="outline-text-4" id="text-5-3-3">
<p>
<a href="https://obsproject.com">OBS</a> (pronounced "awbz", short for Open Broadcaster Software) is what we use to
do streaming. Setting up streaming to Twitch is pretty simple with OBS. All
that's required is an API Key from Ground Kontrol. The API key is secret so it
shouldn't be published anywhere. This means you have to talk to staff or
ownership at Ground Kontrol in order to get it.
</p>

<p>
We still need to get a list of contacts that can provide the key.
</p>
</div>

<ol class="org-ol">
<li><a id="org3cef0f1"></a>overlays<br />
<ol class="org-ol">
<li><a id="org9dc5727"></a>chat<br />
<div class="outline-text-6" id="text-5-3-3-1-1">
<p>
<a href="https://nightdev.com/kapchat/">https://nightdev.com/kapchat/</a>
</p>
</div>
</li>
<li><a id="org217caf2"></a>video sources<br />
<div class="outline-text-6" id="text-5-3-3-1-2">
<p>
I noticed my laptop struggling with the video sources when pulling in max
resolution. I switched them to 320x200 (or close to that), and it seems to work
much better. I suspect this is a throughput issue with 4 video sources coming in
to one little laptop. The cameras aren't really that high res and the area of
the screen they are displayed in is very small. There was no noticeable loss in
quality when switching to the lower res.
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org0ffd586" class="outline-2">
<h2 id="org0ffd586"><span class="section-number-2">6</span> troubleshooting</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgc1aef34" class="outline-3">
<h3 id="orgc1aef34"><span class="section-number-3">6.1</span> If the input is not recognized on the computer's end</h3>
<div class="outline-text-3" id="text-6-1">
<p>
The known recipe (not fool proof, but most of the work):
</p>
<ol class="org-ol">
<li>Reboot the cabs with the computer's input (HDMI capture box).</li>
<li>Reintroduce other slots (monitors x2 and the projector).</li>
</ol>
</div>
</div>
</div>
